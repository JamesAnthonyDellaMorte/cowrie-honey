# Cowrie Honeypot — Malware Analysis Report

**Author:** James
**Date:** 2026-02-19
**Collection period:** ~11 hours (Feb 18 21:04 – Feb 19 08:12 EST)
**Infrastructure:** Cowrie SSH honeypot in proxy mode with ARM64 backend

---

## Executive Summary

218 malware samples were collected via a Cowrie SSH honeypot running in proxy mode. All samples were classified into **6 distinct families** using custom YARA rules built from static analysis with radare2 and Ghidra. Detection rate: **218/218 (100%)** with zero generic catch-all rules — every detection is family-specific.

| Family | Samples (dl/) | Unique SHA256 | Samples (unanalyzed/) | Severity |
|--------|:------------:|:-------------:|:---------------------:|----------|
| Redtail | 143 | 88 | 0 | High |
| TrojanSSHD | 45 | 26 | 0 | Critical |
| Dot16_B0s | 27 | 25 | 16 | High |
| Aarch64GoBot | 0 | 0 | 4 | High |
| XorDDoS | 1 | 1 | 0 | Critical |
| SSHKeyInjection | 1 | 1 | 0 | Medium |
| **Total** | **217** | **141** | **20** | |

---

## Family 1: Redtail Cryptominer

### Overview
- **Type:** Cryptominer (likely Monero/RandomX)
- **Packer:** UPX with LZMA compression — standard and modified (`#UPX!`) headers
- **Linking:** Statically linked, stripped section headers
- **Architectures:** x86_64 (53), i686 (46), arm8 (27), arm7 (15), shell scripts (2)
- **Size range:** 795 B – 1,880,264 B

### Architecture Breakdown
| Arch | Count | UPX Header | Notes |
|------|:-----:|------------|-------|
| x86_64 | 53 | Modified (`#UPX!`) | All share modified UPX magic byte |
| i686 | 46 | Standard (`UPX!`) | 32-bit Intel |
| arm8 / aarch64 | 27 | Standard (`UPX!`) | 64-bit ARM |
| arm7 | 15 | Standard (`UPX!`) | 32-bit ARM |
| setup.sh | 1 | N/A | Dropper script |
| clean.sh | 1 | N/A | Competitor-killing script |

### Key Signature: UPX Block Fingerprint
All 141 Redtail ELF binaries share a unique 4-byte compressed block signature at offset +35 from the `UPX!` magic:

```
Hex: 3f 91 45 84
```

This appears to be a packer-specific artifact from the Redtail build pipeline. It was confirmed across **141/141 Redtail samples** and **0/57 non-Redtail samples** — zero false positives.

The full UPX header pattern (38 bytes, wildcarded for cross-architecture matching):
```
55 50 58 21  ?? ?? 0e ??  00 00 00 00  ?? ?? ?? 00
?? ?? ?? 00  ?? ?? 00 00  ?? 00 00 00  0e 00 00 00
?? ?? 00 3f  91 45 84
```

### UPX Header Details (per architecture)
| Arch | UPX Offset | Version | Format | Method | Level |
|------|:----------:|:-------:|:------:|:------:|:-----:|
| x86_64 | 0x154 | 0xe4 | 0x10 | 0x0e (LZMA) | 0x16 |
| i686 | 0x0e0 | 0x3c | 0x14 | 0x0e (LZMA) | 0x0c |
| arm7 | 0x098 | 0x58 | 0x16 | 0x0e (LZMA) | 0x17 |
| arm8 | 0x0ec | 0x74 | 0x13 | 0x0e (LZMA) | 0x2a |

All samples within each architecture have **byte-identical** UPX headers.

### Dropper Script (`783adb7ad-setup.sh`)
Multi-architecture dropper that:
1. Detects CPU architecture via `uname -mp`
2. Finds writable, executable directories (avoids `noexec` mounts)
3. Copies architecture-specific binary (`redtail.x86_64`, `redtail.i686`, `redtail.arm7`, `redtail.arm8`)
4. Renames to random string (`.$(random)`)
5. Executes with `ssh` argument
6. Cleans up original binaries

### Competitor-Killing Script (`d46555af1-clean.sh`)
Removes competing miners:
- Disables `c3pool_miner` systemd service
- Strips malicious crontab entries via `grep -vE` (removes wget, curl, /dev/tcp, base64)
- Uses `chattr -ia` to unlock immutable files
- Wipes `/tmp`, `/var/tmp`, `/dev/shm`

### Sample SHA256 Hashes
```
3625d068896953595e75df328676a08bc071977ac1ff95d44b745bbcb7018c6f  redtail.arm7
cf37301e55831b52769873b9f5e4140d11fa8b54668de4660bc0ac45b097799b  redtail.x86_64
95a01bd1213418febc96aaab48f67191a5e0e7b32efc6c5dc036fcb693043ea4  redtail.arm8
f2ab1eaffb33ca0978180027e559a7789b0765f66dffaa031527dff5f7a219a1  redtail.x86_64
048e374baac36d8cf68dd32e48313ef8eb517d647548b1bf5f26d2d0e2e3cdc7  redtail.i686
```

---

## Family 2: TrojanSSHD (Go SSH Backdoor)

### Overview
- **Type:** SSH backdoor + credential stealer + dual cryptominer
- **Language:** Go with CGO (PAM integration via C bindings)
- **Linking:** Dynamically linked (requires `ld-linux-x86-64.so.2`)
- **Architecture:** x86_64 only
- **Size range:** 294,912 B – 8,028,160 B
- **Samples:** 45 (26 unique hashes)

### Capabilities (from string analysis + r2)
All 26 unique binaries share **4,896 common strings** — they are variants of the same codebase.

**SSH Backdoor:**
- Full SSH server implementation via `golang.org/x/crypto/ssh`
- SFTP support via `github.com/pkg/sftp`
- PAM authentication hooks (`libpam.so.0`, `LIBPAM_1.0`)
- Custom PAM conversation callback (`cbPAMConv`, `RespondPAM`)
- Credential harvesting (`main.credential`, `*[]main.credential`)
- Custom password lookup (`Cfunc_mygetpwnam_r`)

**Credential Stuffing:**
- Attack propagation queue (`attackqueue`)
- Credential structure for automated SSH brute-forcing
- Function signature: `*struct { F uintptr; attackqueue *[]main.credential }`

**Dual Miner Configuration:**
- XMRig: `Xmrig_enabled`, `Xmrig_algo`, `Xmrig_poolAddr`, `Xmrig_poolUser`, `Xmrig_poolPass`
- NBMiner: `Nbminer_enabled`, `Nbminer_algo`, `Nbminer_poolAddr`, `Nbminer_poolUser`, `Nbminer_poolPass`
- Mining rig config: `main._rig_config`

**System Profiling:**
- CPU info via `github.com/shirou/gopsutil/cpu`
- Network info via `github.com/shirou/gopsutil/net`
- Process info via `github.com/shirou/gopsutil/process`

**Persistence:**
- Systemd service: `/lib/systemd/system/systemd-worker.service`
- Auto-start: `WantedBy=multi-user.target`

### CGO Build Hashes
Three distinct CGO build identifiers found across the sample corpus:
```
_cgo_6cc2654a8ed3
_cgo_eba3282b571c
_cgo_129d52bb6bd3
```

### Key PAM Hook Functions (from r2)
```
_cgo_eba3282b571c_Cfunc_pam_authenticate
_cgo_eba3282b571c_Cfunc_pam_start
Cfunc_init_pam_conv
Cfunc_pam_chauthtok
Cfunc_mygetpwnam_r
cbPAMConv
```

### Sample SHA256 Hashes
```
1191c37f1446692ed0ae4eac2aee323352bc8dbc413499d4acd6cea14256b6de  sshd (5,603,328B)
ea09d3cae042adabbc49eb127259419e171a561e028410ea69eca4a038f9f8a3  sshd (6,127,616B)
5c73e0b861cabc1ce5d9905f927385252914944768b766e7709627a545fd02c6  sshd (3,964,928B)
3730c1d50f16b06bd71bf4ad8864318f53725701018555b6a2819fb2d25aaf2f  sshd (5,308,416B)
8fd411d30ce27d8692db5eb1d99cbba517d990700624112f78c37e553ae6e4ac  sshd (3,473,408B)
```

---

## Family 3: Dot16 / B0s (Aarch64 Bot)

### Overview
- **Type:** Bot (likely DDoS or proxy)
- **Architecture:** ARM64 (aarch64) — dynamically linked
- **Toolchain:** Custom cross-compilation with specific library paths
- **Size range:** 327,680 B – 5,501,911 B
- **Samples:** 43 total (27 in dl/, 16 in unanalyzed/)

### Key Signature: Build Path Fingerprints
These binaries contain hardcoded paths from the attacker's cross-compilation environment:
```
/root/aarch64-libs/curl/lib
/usr/local/aarch64/krb5-1.20.1
```

These paths indicate the attacker cross-compiled libcurl and Kerberos 5 libraries for ARM64, linking them into the bot binary. This is a strong and unique indicator — it reveals the attacker's build machine configuration.

### File Type
```
ELF 64-bit LSB executable, ARM aarch64, version 1 (GNU/Linux),
dynamically linked, interpreter /lib/ld-linux-aarch64.so.1,
missing section headers
```

### Sample SHA256 Hashes
```
a1ce245cebe36d99d998158ce8e18268122047f086fadc6f5f0e781e67b87a91  .16 (2,129,920B)
f337e40bdae9cf3cf01e8a297cc01862714b231fd6f68143854150749616c289  .16   (786,432B)
debd9561202fceb1b646d0925ada0b3a00c28e99b292d51fbe7dd3bb8cf0f216  .16 (4,128,768B)
de49ef20610612e04d3176ba20d3d1cebcf43b790f65b70e4700403bfb76354d  .b0s (4,456,448B)
c1a7c3117cb5236507f6c5f253989862dd6dc019cb9e76eaffd345bc90d43c74  .16 (1,507,328B)
```

---

## Family 4: Aarch64GoBot (Packed Go ARM64 Bot)

### Overview
- **Type:** Bot (packed, heavily obfuscated)
- **Language:** Go (identified by build ID)
- **Architecture:** ARM64 — statically linked
- **Samples:** 4 (all in unanalyzed/)
- **Size range:** 1,703,936 B – 3,244,032 B

### Key Signatures
All 4 samples share an identical Go build ID:
```
kSkyaQnBpMWHzhzftUbB/3Ikfs90WHFlfPTOw24GH/osoLgJOcg3PCo1G1cRJi/vwyuEKIfyrx-ufYfDm3w
```

Less-stripped variants also contain Go runtime pool structures:
- `*sync.Pool`, `deferpool`, `framePool`, `writePool`, `buildOnce`

### File Type
```
ELF 64-bit LSB executable, ARM aarch64, version 1 (SYSV),
statically linked, too large section header offset
```

The "too large section header offset" indicates corrupted/packed section headers — a common anti-analysis technique.

---

## Family 5: XorDDoS

### Overview
- **Type:** DDoS botnet
- **Architecture:** i386 (32-bit Intel) — statically linked, stripped
- **Built for:** Linux 2.6.9
- **Size:** 555,272 B
- **Samples:** 1

### Key Signatures
- Anti-forensics: `HISTFILE=/dev/null`, `MYSQL_HISTFILE=/dev/null`
- Self-monitoring: `/proc/self/exe`, `/proc/%d/exe`
- Persistence: `# chkconfig:`, `### BEGIN INIT INFO` (init.d service)

### File Type
```
ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV),
statically linked, for GNU/Linux 2.6.9, stripped
```

### SHA256
```
5b15e7a49f953e28a06ee8aa2d50811edd8566005117af2b0599d07bbd41d8d9  skhqwensw (555,272B)
```

---

## Family 6: SSH Key Injection

### Overview
- **Type:** Persistence via SSH authorized_keys injection
- **Size:** 398 B
- **Samples:** 1

### SHA256
```
8a68d1c08ea31250063f70b1ccb5051db1f7ab6e17d46e9dd3cc292b9849878b  authorized_keys (398B)
```

---

## YARA Rules Summary

10 rules in `/root/cowrie/reports/rules.yar`:

| Rule | Family | Detection Method | Confirmed |
|------|--------|-----------------|:---------:|
| `Redtail_Miner_UPX` | Redtail | UPX block hex fingerprint `3f914584` | 141/141 |
| `Redtail_Dropper_Script` | Redtail | Architecture names + cleanup patterns | 1/1 |
| `Redtail_Clean_Script` | Redtail | `clean_crontab` + c3pool + chattr | 1/1 |
| `Trojan_SSHD_Go_Backdoor` | TrojanSSHD | CGO hashes + PAM + miner config | 26/26 |
| `Trojan_SSHD_Go_PAM` | TrojanSSHD | PAM C functions + libpam.so | 26/26 |
| `Dot16_B0s_Aarch64_Bot` | Dot16_B0s | Cross-compilation build paths | 43/43 |
| `Aarch64_Go_Packed_Bot` | Aarch64GoBot | Go build ID + runtime pool strings | 4/4 |
| `XorDDoS_ELF` | XorDDoS | HISTFILE + /proc/self + init.d | 1/1 |
| `SSH_Key_Injection` | SSHKeyInjection | SSH public key prefixes | 1/1 |

**Overall: 218/218 samples classified (100%), 0 generic/catch-all rules.**

---

## Tools Used

| Tool | Purpose |
|------|---------|
| **radare2 (r2)** | Binary analysis, ELF header parsing, UPX stub analysis |
| **Ghidra** | Decompilation, Go binary analysis, function identification |
| **strings** | String extraction from packed/stripped binaries |
| **yara-python 4.5.4** | Rule compilation and scanning |
| **file** | ELF type identification |
| **VirusTotal** | External threat intelligence correlation |

---

## File Locations

```
/root/cowrie/reports/rules.yar        # YARA rules
/root/cowrie/reports/yara-scan.py     # YARA scanner script
/root/cowrie/reports/malware-analysis.md  # This report
/root/cowrie/dl/                      # Classified samples (198 files)
/root/cowrie/unanalyzed/              # Pending deeper analysis (20 files)
```

### Scanner Usage
```bash
python3 yara-scan.py              # Scan dl/ directory
python3 yara-scan.py --unanalyzed # Scan unanalyzed/ directory
python3 yara-scan.py <file>       # Scan single file
```
